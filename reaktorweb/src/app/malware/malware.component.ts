import { HttpClient } from '@angular/common/http';
import {Component, NgModule, OnInit} from '@angular/core';
import { Malware } from '../computer-dto';
import {FormBuilder, FormGroup, FormsModule} from '@angular/forms';
import Axios from "axios";


@Component({
  selector: 'app-malware',
  templateUrl: './malware.component.html',
  styleUrls: ['./malware.component.css']
})
export class MalwareComponent implements OnInit {

  malwareForm!: FormGroup;
  malwares: Malware[] = [];


  constructor(private http: HttpClient, private readonly fb: FormBuilder) { }

  ngOnInit(): void {
    this.malwareForm = this.initForm();
    this.obtenerMalwares();
  }

  initForm(): FormGroup {
    return this.fb.group({
      name: '',
      description: ''
    });
  }

  obtenerMalwares(): void {
    this.http.get<Malware[]>('http://localhost:8084/malware').subscribe(
      malwares => this.malwares = malwares,
      error => console.error(error)
    );
  }

  eliminarMalware(name: string): void {
    Axios.delete(`http://localhost:8084/malware/${name}`)
      .then(() => this.obtenerMalwares())
      .catch((reason: any) => console.error(reason));
  }


  crearMalware(): void {
    const nuevoMalware: Malware = {
      name: this.malwareForm.get('name')?.value,
      description: this.malwareForm.get('description')?.value
    };
    if (nuevoMalware.name.length > 0 && nuevoMalware.description.length > 0)
    {
      Axios.post('http://localhost:8084/malware', nuevoMalware)
        .then(
          () => {
              this.obtenerMalwares()
              this.malwareForm.reset();
          }
        )
        .catch((reason: any) => console.error(reason));
    }
  }
}
